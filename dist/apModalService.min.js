"use strict";angular.module("angularPoint").service("apModalService",["$modal","apModelFactory","_","toastr",function(a,b,c,d){function e(b){return function d(){var e=d,f={templateUrl:b.templateUrl,controller:b.controller,resolve:{}},g=c.extend({},f,b),h=arguments;c.each(b.expectedArguments,function(a,b){g.resolve[a]=function(){return h[b]}});var i=a.open(g);return h[0]&&(e.snapshot=angular.copy(h[0]),i.result.then(function(){},function(){c.extend(h[0],e.snapshot)})),i.result}}function f(a,b){function c(a){var b=a.resolvePermissions();d.userCanEdit=b.EditListItems,d.userCanDelete=b.DeleteListItems,d.userCanApprove=b.ApproveItems,d.fullControl=b.FullMask}var d={userCanApprove:!1,userCanDelete:!1,userCanEdit:!1,fullControl:!1};return a&&a.id&&a.resolvePermissions?c(a):b&&b.resolvePermissions&&c(b),d}function g(a,b,d){var e={displayMode:"View",locked:!1,lockedBy:"",negotiatingWithServer:!1,ready:!1},g=f(a,d);return a&&a.id?g.userCanEdit&&(e.displayMode="Edit"):e.displayMode="New",c.extend(e,g,b)}function h(a,b,c,e){var f=window.confirm("Are you sure you want to delete this record?");f&&(b.negotiatingWithServer=!0,a.deleteItem(e).then(function(){d.success("Record deleted successfully"),c.close()},function(){d.error("Failed to delete record.  Please try again.")}))}function i(a,b,c,e,f){a.id?a.saveChanges(f).then(function(){d.success("Record updated"),e.close()},function(){d.error("There was a problem updating this record.  Please try again.")}):b.addNewItem(a,f).then(function(){d.success("New record created"),e.close()},function(){d.error("There was a problem creating a new record.  Please try again.")})}function j(a,b){return g(a,b,this)}return b.Model.prototype.initializeModalState=j,{deleteEntity:h,initializeState:g,modalModelProvider:e,getPermissions:f,saveEntity:i}}]);